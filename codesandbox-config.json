{
  "template": "node",
  "title": "Zamong Editor - Issue Reproduction",
  "description": "Minimal reproduction of canvas context error and layout overlap issues",
  "main": "src/index.js",
  "files": {
    "package.json": {
      "content": {
        "name": "zamong-issue-reproduction",
        "version": "1.0.0",
        "description": "Reproduction of canvas and layout issues",
        "main": "src/index.js",
        "scripts": {
          "dev": "next dev",
          "build": "next build",
          "start": "next start"
        },
        "dependencies": {
          "next": "^15.1.0",
          "react": "^18.2.0",
          "react-dom": "^18.2.0",
          "fabric": "^5.3.0"
        },
        "devDependencies": {
          "typescript": "^5.7.2",
          "@types/node": "^22.10.2",
          "@types/react": "^18.3.17",
          "@types/react-dom": "^18.3.5"
        }
      }
    },
    "src/pages/index.js": {
      "content": "import { useState, useEffect, useRef } from 'react';\nimport { fabric } from 'fabric';\n\nexport default function IssueReproduction() {\n  const [currentTest, setCurrentTest] = useState('canvas');\n  const [logs, setLogs] = useState([]);\n  const canvasRef = useRef(null);\n  const fabricCanvasRef = useRef(null);\n  const [isDisposed, setIsDisposed] = useState(false);\n\n  const addLog = (message, type = 'info') => {\n    const timestamp = new Date().toLocaleTimeString();\n    setLogs(prev => [...prev, { timestamp, message, type }]);\n  };\n\n  // Canvas Error Reproduction\n  const createCanvas = () => {\n    if (canvasRef.current) {\n      fabricCanvasRef.current = new fabric.Canvas(canvasRef.current, {\n        width: 400,\n        height: 300,\n        backgroundColor: '#ffffff'\n      });\n      setIsDisposed(false);\n      addLog('Canvas created successfully', 'success');\n    }\n  };\n\n  const loadImage = () => {\n    if (!fabricCanvasRef.current) {\n      addLog('No canvas available', 'error');\n      return;\n    }\n\n    addLog('Starting image load...', 'info');\n    \n    // Simulate the race condition\n    setTimeout(() => {\n      if (fabricCanvasRef.current) {\n        fabricCanvasRef.current.dispose();\n        fabricCanvasRef.current = null;\n        setIsDisposed(true);\n        addLog('Canvas disposed while image loading', 'warning');\n      }\n    }, 100);\n\n    // Simulate async image loading\n    fabric.Image.fromURL('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9ImciIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPjxzdG9wIG9mZnNldD0iMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiNmZmY7c3RvcC1vcGFjaXR5OjEiIC8+PHN0b3Agb2Zmc2V0PSIxMDAlIiBzdHlsZT0ic3RvcC1jb2xvcjojZGRkO3N0b3Atb3BhY2l0eToxIiAvPjwvbGluZWFyR3JhZGllbnQ+PC9kZWZzPjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iMzAwIiBmaWxsPSJ1cmwoI2cpIiAvPjx0ZXh0IHg9IjIwMCIgeT0iMTUwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LXNpemU9IjI0IiBmaWxsPSIjMzMzIj5UZXN0IEltYWdlPC90ZXh0Pjwvc3ZnPg==', (img) => {\n      try {\n        if (isDisposed || !fabricCanvasRef.current) {\n          addLog('ERROR: Canvas disposed while image still loading', 'error');\n          return;\n        }\n        \n        fabricCanvasRef.current.setBackgroundImage(img, () => {\n          fabricCanvasRef.current.renderAll();\n          addLog('Image loaded successfully', 'success');\n        });\n      } catch (error) {\n        addLog(`ERROR: ${error.message}`, 'error');\n      }\n    });\n  };\n\n  return (\n    <div style={{ padding: '20px', fontFamily: 'Arial, sans-serif' }}>\n      <h1>Zamong Editor - Issue Reproduction</h1>\n      \n      <div style={{ marginBottom: '20px' }}>\n        <button \n          onClick={() => setCurrentTest('canvas')}\n          style={{ \n            margin: '5px', \n            padding: '10px', \n            backgroundColor: currentTest === 'canvas' ? '#007bff' : '#f8f9fa',\n            color: currentTest === 'canvas' ? 'white' : 'black',\n            border: '1px solid #ccc',\n            borderRadius: '4px'\n          }}\n        >\n          Canvas Context Error\n        </button>\n        <button \n          onClick={() => setCurrentTest('layout')}\n          style={{ \n            margin: '5px', \n            padding: '10px', \n            backgroundColor: currentTest === 'layout' ? '#007bff' : '#f8f9fa',\n            color: currentTest === 'layout' ? 'white' : 'black',\n            border: '1px solid #ccc',\n            borderRadius: '4px'\n          }}\n        >\n          Layout Overlap\n        </button>\n      </div>\n\n      {currentTest === 'canvas' && (\n        <div>\n          <h2>Canvas Context Error Reproduction</h2>\n          <p>This test reproduces the canvas disposal race condition.</p>\n          \n          <div style={{ marginBottom: '20px' }}>\n            <button onClick={createCanvas} style={{ margin: '5px', padding: '8px 16px' }}>\n              Create Canvas\n            </button>\n            <button onClick={loadImage} style={{ margin: '5px', padding: '8px 16px' }}>\n              Load Image (with disposal)\n            </button>\n          </div>\n          \n          <canvas \n            ref={canvasRef}\n            width={400} \n            height={300} \n            style={{ border: '1px solid #ccc', marginBottom: '20px' }}\n          />\n        </div>\n      )}\n\n      {currentTest === 'layout' && (\n        <div>\n          <h2>Layout Overlap Reproduction</h2>\n          <p>Resize your browser to 360-420px width to see the overlap.</p>\n          \n          <div style={{ \n            display: 'grid', \n            gridTemplateColumns: window.innerWidth >= 1024 ? '1fr 1fr' : '1fr',\n            gap: '20px',\n            border: '2px solid red',\n            padding: '10px'\n          }}>\n            <div style={{ \n              border: '1px solid #ccc', \n              padding: '15px',\n              minWidth: '400px', // This causes overflow on mobile\n              backgroundColor: '#f8f9fa'\n            }}>\n              <h3>Canvas Preview</h3>\n              <div style={{ \n                width: '400px', \n                height: '300px', \n                border: '1px solid #999',\n                backgroundColor: 'white',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center'\n              }}>\n                Canvas (400px wide)\n              </div>\n            </div>\n            \n            <div style={{ \n              border: '1px solid #ccc', \n              padding: '15px',\n              minWidth: '300px', // This also causes overflow\n              backgroundColor: '#f8f9fa'\n            }}>\n              <h3>Text Styler Controls</h3>\n              <div style={{ display: 'flex', flexDirection: 'column', gap: '10px' }}>\n                <button style={{ padding: '8px' }}>Font Family</button>\n                <button style={{ padding: '8px' }}>Font Size</button>\n                <button style={{ padding: '8px' }}>Text Color</button>\n                <button style={{ padding: '8px' }}>Alignment</button>\n              </div>\n            </div>\n          </div>\n          \n          <div style={{ marginTop: '20px', padding: '10px', backgroundColor: '#fff3cd' }}>\n            <strong>Current viewport width: {window.innerWidth}px</strong>\n            <br />\n            {window.innerWidth >= 360 && window.innerWidth <= 420 && (\n              <span style={{ color: 'red' }}>⚠️ Critical viewport size - overlap likely!</span>\n            )}\n          </div>\n        </div>\n      )}\n\n      <div style={{ marginTop: '30px' }}>\n        <h3>Test Logs</h3>\n        <div style={{ \n          height: '200px', \n          overflow: 'auto', \n          border: '1px solid #ccc', \n          padding: '10px',\n          backgroundColor: '#f8f9fa',\n          fontFamily: 'monospace',\n          fontSize: '12px'\n        }}>\n          {logs.map((log, index) => (\n            <div \n              key={index} \n              style={{ \n                color: log.type === 'error' ? 'red' : log.type === 'warning' ? 'orange' : log.type === 'success' ? 'green' : 'black'\n              }}\n            >\n              [{log.timestamp}] {log.message}\n            </div>\n          ))}\n        </div>\n      </div>\n    </div>\n  );\n}"
    },
    "next.config.js": {
      "content": "/** @type {import('next').NextConfig} */\nconst nextConfig = {\n  reactStrictMode: true,\n  swcMinify: true,\n}\n\nmodule.exports = nextConfig"
    },
    "README.md": {
      "content": "# Zamong Editor - Issue Reproduction\n\nThis CodeSandbox demonstrates two critical issues in the Zamong Text Editor:\n\n## Issue 1: Canvas Context Error\n1. Click \"Create Canvas\"\n2. Click \"Load Image (with disposal)\"\n3. Observe error in logs when canvas is disposed while image is loading\n\n## Issue 2: Layout Overlap\n1. Switch to \"Layout Overlap\" tab\n2. Resize browser window to 360-420px width\n3. Observe how UI elements overlap and become unusable\n\n## Testing Instructions\n- Use browser dev tools to simulate mobile devices\n- Test viewport widths: 360px, 375px, 390px, 420px\n- Check console for errors during canvas operations\n\n## Expected Results\n- Canvas disposal should not cause errors\n- Layout should remain usable on all viewport sizes\n- Touch targets should be accessible on mobile devices"
    }\n  }\n}
